# AVDSP for LINUX

## Compile

Linux AVDSP runtime and encoder need libasound-devel, libsndfile-devel, make, gcc, and CMake packages

To compile it : 
```
cd AVDSP/module_avdsp
mkdir build
cd build
cmake ..
make 
```

This will create the `dspcreate` command and the  `libasound_module_pcm_avdsp.so` alsa external pluging in the build directory

## Create bytecode avdsp programm

Use the `dspcreate` command as stated in AVDSP general documentation.

## Install & Alsa configuration

1. Copy the `libasound_module_pcm_avdsp.so` into your distrib alsa external plugin directory (ie for fedora : `/usr/lib64/alsa-lib/`, for volumio : `/usr/lib/arm-linux-gnueabihf/alsa-lib`).

2 . Create an alsa device in your alsa conf file (.asoundrc, /etc/asound.conf, etc ...) :

```
pcm.dsp {
        type avdsp
	dspprog "/mydir/myavdsp.bin"
        slave {
                pcm "hw:USB,0"
        }
}
```

* `/mydir/myavdsp.bin` is the path of the bytecode file that has been generated by dspcreate.
* `hw:USB,0` must be replaced by the name of your alsa output device.
remark : the number of outputs used in the dspcode must be the same as the number of channel supported by your output devices, even if not used. 
The number of input used in the dspcode will be shown as the number of channels available in your dsp plugin and therefore should be 2 in most case. 
It is possible to create multiple dsp plugin for multiple dspcode programs supporting different number of channels.

 ## Use

Just play music using the new dsp alsa device.

```
aplay -D dsp test.wav
```

For example, unsing mpd, juste configure the audio_output in mpd.conf as :

```
audio_output {
        type            "alsa"
        name            "Main"
        device          "dsp"
        dop             "no"
        mixer_type      "software"
        auto_resample   "no"
        auto_format     "no"
}
```


